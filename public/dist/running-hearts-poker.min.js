/*! running-hearts-poker 2017-09-15 */

!function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return a(n||e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="runningHeartsApp";angular.module(i,["ui.router","ngMaterial","ngAnimate","ngAria","ngMessages","ngResource"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("deep-orange").accentPalette("deep-orange",{default:"900"}).warnPalette("grey",{default:"300"}).backgroundPalette("grey"),e.theme("playerOut").primaryPalette("green",{default:"600"}).accentPalette("grey",{default:"600"}).warnPalette("grey",{default:"800"}),e.theme("playerIn").primaryPalette("red",{default:"600"}).accentPalette("grey",{default:"600"}).warnPalette("grey",{default:"800"})}]).config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!0})}]).config(["$qProvider",function(e){e.errorOnUnhandledRejections(!1)}]),angular.module(i).constant("Entities",{PLAYER:1,EVENT:2,VENUE:3,GAME:4,SEASON:5,fromId:function(e){var t,n=this,r=parseInt(e);return angular.forEach(this,function(e,a){e===r&&(t=n[a])}),t}});var o=function(e,t,n,r,a){function i(){r.getPermissions(function(e){o.permissions=e})}var o=this;o.mdMedia=n,o.ENTITY_TYPE=a,i()};angular.module(i).controller("eventsCtrl",o),o.$inject=["$filter","$state","$mdMedia","permissionsService","Entities"];var s=function(e,t,n,r){function a(e){var n=r.arrays(e).find(i.isCurrentEvent);n.length&&t(function(){i.list.topIndex=r.arrays(e).orderedIndexOf("-date",{_id:n[0]._id})})}var i=this;i.list={},i.getEvents=function(){i.events=n.api().season(a)},i.newEvent=function(){e.transitionTo("events.manage")},i.viewEvent=function(t){e.transitionTo("events.view",{id:t._id})},i.isCurrentEvent=function(e){return moment().isSame(moment(e.date),"d")},i.getEvents()};angular.module(i).controller("eventsListCtrl",s),s.$inject=["$state","$timeout","eventsService","Utils"];var u=function(e,t,n,r,a,i,o,s,u,l,c){function f(){c.getPermissions(function(e){m.permissions=e})}var m=this;m.forms={},m.permissions={},m.event={},m.directors=[],m.getDirectors=function(){m.directors=i.api().findBy({isTd:!0})},m.getVenues=function(){m.venues=o.api().query()},m.resetEvent=function(){m.event={}},m.reset=function(e,t){u.resetValidity(e,t)},m.save=function(){r.api().save(m.event,function(){t.transitionTo("events.list")},function(e){switch(e.data.code){case"EVENT_ALREADY_EXISTS":e.config.data.$$saving=!1,m.forms.manageEvent.date.$setValidity("eventAlreadyExists",!1);break;default:l.handleApiError(e)}})},m.cancel=function(){s.goPrevious()},m.getEvent=function(e){r.api(e).get(function(e){e.date=new Date(e.date),m.event=e})},m.removeEvent=function(e){r.api(e._id).remove(function(){t.transitionTo("events.list")})},m.canCreateEvent=function(e){return m.permissions.CREATE_ANY_EVENT||e>=new Date},f(),m.getDirectors(),m.getVenues(),n.id&&m.getEvent(n.id)};angular.module(i).controller("eventsManageCtrl",u),u.$inject=["$filter","$state","$stateParams","eventsService","usersService","playersService","venuesService","historyService","formService","errorService","permissionsService"];var l=function(e,t,n,r,a,i){var o=this;o.getEvent=function(e){o.event=n.api(e).get(function(){o.event.isToday=moment().isSame(o.event.date,"d")})},o.removeEvent=function(t){a.confirm("Are you sure you want to delete this event?").then(function(){n.api(t._id).remove(function(){e.go("events.list")})})},o.newGame=function(){o.game={event:o.event,number:o.event.games.length+1},r.api().create(o.game,function(e){o.viewGame(e)},function(e){i.handleApiError(e)})},o.editEvent=function(t){t?e.transitionTo("events.manage",{id:t._id}):e.transitionTo("events.list")},o.viewGame=function(t){e.transitionTo("games.view",{id:t._id})},o.completeGame=function(e){a.confirm("Game will be marked complete and scores cannot be changed.\n      Scores will be submitted to season standings.").then(function(){e.completed=!0,r.api().save(e)})},t.id&&o.getEvent(t.id)};angular.module(i).controller("eventsViewCtrl",l),l.$inject=["$state","$stateParams","eventsService","gamesService","dialogService","errorService"];var c=function(e){function t(){e.getPermissions(function(e){n.permissions=e})}var n=this;t()};angular.module(i).controller("gamesCtrl",c),c.$inject=["permissionsService"];var f=function(e,t,n,r,a,i,o,s){function u(){var t=e("filter")(p.game.players,{score:1},function(e,t){return e<t||void 0===e});if(t)return t.length-1}function l(e){return 0===e?10:e<8?9-e:1}function c(e){return 10==e?1:e>1&&e<9?10-e:9}function f(e,t){delete e.score,delete e.rank,t||delete e.cashedOutTime}function m(e){var t=u();e.score=l(t),e.cashedOutTime=Date.now(),e.rank=c(e.score)}function v(e,t){angular.forEach(e,function(e){t&&(e.rank=e.rank-2),e.score=l(e.rank),e.rank=e.rank+1})}function d(t){var n=e("orderBy")(t,"cashedOutTime");angular.forEach(p.game.players,function(e){e.cashedOutTime&&f(e,!0)}),angular.forEach(n,function(e){e.cashedOutTime&&m(e)}),p.game.players=n,g()}function g(e,t){p.game.$save(function(){e&&"function"==typeof e&&e()},function(e){s.handleApiError(e),t&&"function"==typeof t&&t()})}var p=this;p.selectPlayer=function(e){var t=e.selected;angular.forEach(p.game.players,function(e){e.selected=!1}),e.selected=!t},p.getGame=function(e){p.game=a.api(e).get(function(){p.game.inProgress?d(p.game.players):(p.game.startTime=Date.now(),p.game.inProgress=!0,g())})},p.playerOut=function(e){var t=u();e.score=l(t),e.cashedOutTime=Date.now(),e.rank=t+1,g(angular.noop,function(){f(e)})},p.playerBackIn=function(t){var n=angular.copy(t);i.confirm("Marking a player back in will adjust all currently ranked\n        players and remove this player's score and rank. Is this okay?").then(function(){var r=e("filter")(p.game.players,function(e){return e.rank<t.rank});f(t),v(r),g(angular.noop,function(){var r=e("filter")(p.game.players,function(e){return e.rank<=n.rank});angular.copy(n,t),v(r,!0)})})},p.completeGame=function(){i.confirm("Game will be marked complete and scores cannot be changed.\n      Scores will be submitted to season standings.").then(function(){p.game.completed=!0,g(function(){t.go("games.view",{id:p.game._id})},function(){p.game.completed=!1})})},p.canComplete=function(){return u()<0},p.resetAllScores=function(){i.confirm("This will reset all scores for all players in this game.").then(function(){angular.forEach(p.game.players,function(e){f(e)}),g()})},p.getGame(n.id)};angular.module(i).controller("gamesPlayCtrl",f),f.$inject=["$filter","$state","$stateParams","$mdDialog","gamesService","dialogService","eventsService","errorService"];var m=function(e,t,n,r,a,i,o,s){var u=this;u.game={},u.forms={},u.list={topIndex:0},u.getGame=function(e){u.game=i.api(e).get(function(){u.originalPlayers=angular.copy(u.game.players),u.getPlayers()})},u.getPlayers=function(){a.api().query(function(e){u.players=e})},u.isExistingPlayer=function(e){return!!s.arrays(u.originalPlayers).findOne({player:{_id:e._id}})},u.toggleSelection=function(e){var t={player:{_id:e._id}};s.arrays(u.game.players).addOrRemove(t)},u.addPlayersToGame=function(){i.api().save(u.game,function(){t.transitionTo("games.view",{id:u.game._id})},function(e){o.handleApiError(e)})},u.validatePlayerName=function(e){u.forms.playerAddForm.name.$setValidity("nameTaken",!0),e&&e.name&&a.api().validate(e,angular.noop,function(e){switch(e.data.code){case"PLAYER_NAME_TAKEN":e.config.data.$$saving=!1,u.forms.playerAddForm.name.$setValidity("nameTaken",!1);break;default:o.handleApiError(e)}})},u.createPlayer=function(e){a.api().save(e,function(t){var r={player:t};u.game.players.push(r),delete e.name,u.players.push(t),n(function(){u.list.topIndex=s.arrays(u.players).orderedIndexOf("name",{_id:t._id})})},function(e){o.handleApiError(e)})},u.getGame(r.gameId)};angular.module(i).controller("gamesPlayersCtrl",m),m.$inject=["$filter","$state","$timeout","$stateParams","playersService","gamesService","errorService","Utils"],function(e){function t(e,t,n){var r=this;r.getGame=function(e){r.game=n.api(e).get()},t.id&&r.getGame(t.id)}e.module(i).controller("gamesViewCtrl",t),t.$inject=["$state","$stateParams","gamesService"]}(angular);var v=function(e,t,n,r,a,i,o,s,u,l,c,f,m){function v(){g.todaysEvents=i.api().byDate({startDate:new Date})}function d(){o.getPermissions(function(e){g.permissions=e})}var g=this;g.mdMedia=a,g.messages={},g.refresh=function(){t.go(t.current,{},{reload:!0})},g.back=function(){c.goPrevious()},g.toggleMenu=function(){f.mainMenu().toggle(!0,m.getChangedEntites())},d(),v()};angular.module(i).controller("homeCtrl",v),v.$inject=["$filter","$state","$scope","$mdSidenav","$mdMedia","eventsService","permissionsService","authApiService","authService","dialogService","historyService","navService","entityService"],function(e){function t(e,t,n,r){var a=this;a.login=function(){t.api().login(a.user,function(e){n.goPrevious()},function(){a.forms.loginForm.username.$setValidity("wrongCreds",!1),a.forms.loginForm.password.$setValidity("wrongCreds",!1)})},a.cancel=function(){n.goPrevious()},a.reset=function(e,t){r.resetValidity(e,t)}}e.module(i).controller("loginCtrl",t),t.$inject=["$state","authApiService","historyService","formService"]}(angular);var d=function(e,t,n,r){function a(){n.getPermissions(function(e){i.permissions=e})}var i=this;i.ENTITY_TYPE=r,a()};angular.module(i).controller("playersCtrl",d),d.$inject=["$state","$stateParams","permissionsService","Entities"];var g=function(e,t){var n=this;n.newPlayer=function(){e.transitionTo("players.manage")},n.getPlayers=function(){n.players=t.api().query()},n.getPlayers()};angular.module(i).controller("playersListCtrl",g),g.$inject=["$state","playersService"];var p=function(e,t,n,r,a,i,o){var s=this;s.forms={},s.getPlayer=function(e){s.player=r.api(e).get()},s.save=function(){r.api().save(s.player,function(){t.transitionTo("players.list")},function(e){o.handleApiError(e)})},s.validate=function(e){s.forms.playerForm.name.$setValidity("nameTaken",!0),e&&e.name&&r.api().validate(e,angular.noop,function(e){switch(e.data.code){case"PLAYER_NAME_TAKEN":e.config.data.$$saving=!1,s.forms.playerForm.name.$setValidity("nameTaken",!1);break;default:o.handleApiError(e)}})},s.cancel=function(){a.goPrevious()},s.reset=function(e,t){i.resetValidity(e,t)},n.id&&s.getPlayer(n.id)};angular.module(i).controller("playersManageCtrl",p),p.$inject=["$filter","$state","$stateParams","playersService","historyService","formService","errorService"];var h=function(e,t,n,r,a,i,o,s,u){function l(e){e.name?c.player=e:c.player=angular.copy(c.originalPlayer)}var c=this;c.media=r,c.stats={},c.getPlayer=function(e,n){c.player=a.api(e).get(function(){return c.originalPlayer=angular.copy(c.player),c.player._id?n?c.getPlayerStatsForSeason(n):void c.getPlayerStats():t.transitionTo("players.list")})},c.getPlayerStatsForSeason=function(e){c.stats.allTime=!1,c.stats.season=o.api(e).get(function(){i.api(c.player._id,c.stats.season.seasonNumber).playerSeason(function(e){l(e)})})},c.getPlayerStats=function(){c.stats.season=null,u.setParams({id:c.player._id,allTime:c.stats.allTime}),c.stats.allTime?i.api(c.player._id).player(function(e){l(e)}):i.api(c.player._id).playerSeason(function(e){l(e)})},c.shoutOut=function(e){a.api(e).shoutOut(function(e){c.player.shoutOuts=e.shoutOuts})},c.save=function(){a.api().save(c.player,function(){t.transitionTo("players.list")})},c.removePlayer=function(e){s.confirm("Are you sure you want to delete this player?").then(function(){a.api(e._id).remove(function(){t.transitionTo("players.list")})})},n.id&&(c.stats.allTime=n.allTime,c.getPlayer(n.id,n.season))};angular.module(i).controller("playersViewCtrl",h),h.$inject=["$filter","$state","$stateParams","$mdMedia","playersService","statsService","seasonsService","dialogService","stateService"],function(e){function t(e,t,n,r){var a=this;a.register=function(){t.api().save(a.user,function(){e.transitionTo("home")},function(e){switch(e.data.code){case"INVALID_TOKEN":e.config.data.$$saving=!1,a.forms.registerForm.token.$setValidity("invalidToken",!1);break;case"DUPLICATE_KEY_ERROR":e.config.data.$$saving=!1,a.forms.registerForm.username.$setValidity("userTaken",!1)}})},a.reset=function(e,t){r.resetValidity(e,t)},a.cancel=function(){n.goPrevious()}}e.module(i).controller("registerCtrl",t),t.$inject=["$state","usersService","historyService","formService"]}(angular);var y=function(e,t,n){function r(){n.getPermissions(function(e){a.permissions=e})}var a=this;r()};angular.module(i).controller("seasonsCtrl",y),y.$inject=["$filter","$state","permissionsService"],function(e){function t(e,t,n,r){var a=this;a.newSeason=function(){var e;r.confirm("Are you sure you want to start a new season?").then(function(){e=a.seasons&&a.seasons.length?a.seasons[0].seasonNumber+1:1,a.season=n.api(e).save(function(){a.getSeason()})})},a.getSeason=function(e){e?a.season=n.api(e).get():a.seasons=n.api().query(function(e){})},a.getSeason(t.id)}e.module(i).controller("seasonsViewCtrl",t),t.$inject=["$state","$stateParams","seasonsService","dialogService"]}(angular),function(e){function t(e,t,n,r,a,i,o){function s(){u.seasons=o.api().query(function(){u.currentSeason=u.seasons[0]})}var u=this;s()}e.module(i).controller("statsCtrl",t),t.$inject=["$filter","$state","statsService","usersService","playersService","venuesService","seasonsService"]}(angular);var S=function(e,t,n,r,a,i,o,s){function u(e){c.seasons=s.api().query(function(){c.latestSeason=c.seasons[0],e||n.all||(e=c.latestSeason.seasonNumber),c.getSeasonStats(e)})}function l(){if(!c.seasonStats)return 0;var e=c.seasonStats.map(function(e){return e.totalPoints});c.stats.highestScore=Math.max.apply(null,e)}var c=this;c.stats={},c.shoutOut=function(e){i.api(e).shoutOut(function(e){c.player.shoutOuts=e.shoutOuts})},c.getSeasonStats=function(e){e?(c.season=r.api(e).season(function(){c.stats.isCurrentSeason=c.season.seasonNumber===c.latestSeason.seasonNumber}),c.seasonStats=r.api(e).seasons(function(){l()})):(c.season=null,c.seasonStats=r.api().players(function(){l()}))},c.stats.showAll=!!n.all,u(n.id)};angular.module(i).controller("statsSeasonCtrl",S),S.$inject=["$filter","$state","$stateParams","statsService","usersService","playersService","venuesService","seasonsService"];var P=function(e,t,n,r,a,i){function o(){a.getPermissions(function(e){s.permissions=e})}var s=this;s.mdMedia=r,s.ENTITY_TYPE=i,o()};angular.module(i).controller("venuesCtrl",P),P.$inject=["$filter","$state","$stateParams","$mdMedia","permissionsService","Entities"],function(e){function t(t,n,r,a,i,o){var s=this;s.errors=[],s.getVenues=function(){s.venues=a.api().query()},s.newVenue=function(){n.transitionTo("venues.manage")},s.viewVenue=function(e){n.transitionTo("venues.view",{id:e._id})},s.editVenue=function(e){n.transitionTo("venues.manage",{id:e._id})},s.removeVenue=function(e){o.confirm("Are you sure you want to delete this venue?").then(function(){a.api(e._id).remove(function(){s.getVenues()})})},s.getVenues(),r.reason?s.errors.push(r.reason):e.noop}e.module(i).controller("venuesListCtrl",t),t.$inject=["$filter","$state","$stateParams","venuesService","permissionsService","dialogService"]}(angular),function(e){function t(e,t,n,r,a,i,o,s){var u=this;u.forms={},u.venue={numberOfGames:1},u.directors=[],u.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u.getDirectors=function(){u.directors=a.api().findBy({isTd:!0})},u.newVenue=function(){u.resetVenue(),t.transitionTo("venues.manage")},u.resetVenue=function(){u.venue={}},u.cancel=function(){i.goPrevious()},u.save=function(){r.api().save(u.venue,function(){t.go("venues.list")},function(e){s.handleApiError(e)})},u.reset=function(e,t){o.resetValidity(e,t)},u.getVenue=function(e){u.venue=r.api(e).get()},u.removeVenue=function(e){r.api(e._id).remove(function(){t.go("venues.list")})},u.getDirectors(),n.id&&u.getVenue(n.id)}e.module(i).controller("venuesManageCtrl",t),t.$inject=["$filter","$state","$stateParams","venuesService","playersService","historyService","formService","errorService"]}(angular),function(e){function t(e,t,n,r,a){var i=this;i.venue={},i.getVenue=function(e){i.venue=r.api(e).get()},i.removeVenue=function(e){r.api(e._id).remove(function(){t.go("venues.list")})},n.id&&i.getVenue(n.id)}e.module(i).controller("venuesViewCtrl",t),t.$inject=["$filter","$state","$stateParams","venuesService","playersService"]}(angular);var E=function(){return{restrict:"E",templateUrl:"../views/templates/list/nameList.html",scope:{list:"=ngModel"}}};angular.module(i).directive("rhpNameList",E),E.$inject=[];var w=function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(e,t,n,r){e.$watch(function(){var t=e.$eval(n.ngModel),r=e.$eval(n.passwordMatch);return t&&r&&t===r&&t.length>=r.length},function(e){r.$setValidity("passwordMatch",e||!1)})}}};angular.module(i).directive("passwordMatch",w),w.$inject=[];var A=function(){function e(e,t,n,r,a,i,o,s,u,l,c,f,m,v){function d(t,n){e.messages[t]=n}function g(e){switch(e){case v.VENUE:a.api().count(function(e){d("venues",e)});break;case v.EVENT:r.api().count(function(e){d("events",e)});break;case v.PLAYER:i.api().count(function(e){d("players",e)});break;case v.SEASON:o.api().query(function(e){d("seasons",e)});break;case v.GAME:s.api().currentSeasonWinners(function(e){d("stats",e)})}}function p(e){angular.forEach(e,function(e){g(e)}),e&&e.length&&m.clearEntities(e)}f.onRefreshNavData(e,function(e){p(e)}),e.loadTabs=function(){e.messages={events:r.api().count(),venues:a.api().count(),players:i.api().count(),seasons:o.api().query(),stats:s.api().currentSeasonWinners()},m.startEntityTimers()},e.isLoggedIn=function(){return u.isAuth()},e.logout=function(){return l.confirm("Are you sure you want to logout?").then(function(){return c.api().logout(function(){n.transitionTo("logout",{},{reload:!0})}),e.toggleMenu()})},e.toggleMenu=function(){t("appSidenav").toggle()},e.loadTabs()}var t={templateUrl:"../views/templates/sideNav/nav.html",restrict:"E",controller:e};return e.$inject=["$scope","$mdSidenav","$state","eventsService","venuesService","playersService","seasonsService","statsService","authService","dialogService","authApiService","navService","entityService","Entities"],t};angular.module(i).directive("rhpSideNav",A),A.$inject=[];angular.module(i).directive("rhpTabs",function(){function e(e,t,n,r,a,i,o){function s(e){f.tabs=[];var n=["List","View"];if(t.all([c(e.parent)]).then(function(){n.push("Manage"),u(n,e)}),u(n,e),"players"===e.parent){var r={name:"Games",path:"players.view.games"};f.tabs.push(r)}}function u(e,t){var n=t.parent;"home"!==n&&(angular.forEach(e,function(e){var t={name:e,path:n+"."+e.toLowerCase()};!!r("filter")(f.tabs,{path:t.path})[0]||f.tabs.push(t)}),t&&l(t))}function l(e){var t=r("filter")(f.tabs,{path:e.name})[0];f.selectedTab=f.tabs.indexOf(t)}function c(e){var t;switch(e.toUpperCase()){case"EVENTS":t="EDIT_EVENT";break;case"VENUES":t="EDIT_VENUE";break;case"PLAYERS":t="EDIT_PLAYER";break;default:return!1}return o.checkPermissions([t])}var f=this;f.tabs=[],f.tabVisibility=function(){var e=n.current.name.split(".")[1];return"list"!==e&&!("manage"===e&&!i.id)},f.tabPath=function(e){var t=e.split(".");i.id?n.transitionTo(e,{id:i.id,season:i.season,allTime:i.allTime}):"list"===t[1]&&n.transitionTo(e)},e.$watch(function(){return n.current},function(e,t){e.parent==t.parent&&f.tabs.length&&"home"!=e.parent?l(e):s(e)})}var t={restrict:"E",template:['<md-tabs ng-if="tabs.tabVisibility()" md-stretch-tabs="always" class="md-primary md-fixed" md-selected="tabs.selectedTab">','  <md-tab ng-click="tabs.tabPath(tab.path)" ng-repeat="tab in tabs.tabs">',"    <md-tab-label>{{tab.name}}</md-tab-label>","  </md-tab>","</md-tabs>"].join(""),scope:{},bindToController:!0,controller:e,controllerAs:"tabs"};return e.$inject=["$scope","$q","$state","$filter","$timeout","$stateParams","permissionsService"],t});var T=function(){return{restrict:"E",templateUrl:"../views/templates/trophy/trophy.html",scope:{count:"=",rank:"=",before:"@",after:"@"},replace:!0,link:function(e,t,n){var r=!angular.isDefined(n.before)&&!angular.isDefined(n.after);e.position={before:angular.isDefined(n.before),after:angular.isDefined(n.after),none:angular.isDefined(n.count)},!angular.isDefined(n.count)&&r&&(console.error("rhpTrophy requires either a 'before' or 'after' attribute."),e.position.before=!1,e.position.after=!0),e.position.none||e.position.before!==e.position.after||r||(console.error("rhpTrophy directive cannot have icon assigned to both 'before' and 'after' positions.","Defaulting to 'after' position."),e.position.before=!1),e.getIconClass=function(e){var t="";switch(e){case 1:t="fa-trophy trophy-gold";break;case 2:t="fa-trophy trophy-silver";break;case 3:t="fa-trophy trophy-bronze";break;default:t="fa-hashtag"}return t},e.getRankClass=function(e){return e>=100?"rhp-trophy-rank-xs":e>=10?"rhp-trophy-rank-sm":"rhp-trophy-rank"}}}};angular.module(i).directive("rhpTrophy",T),T.$inject=[];var b=function(){return{restrict:"E",templateUrl:"../views/templates/trophy/trophyList.html",scope:{ranks:"=",vertical:"@"},replace:!0}};angular.module(i).directive("rhpTrophyList",b),b.$inject=[];var C=function(e,t){function n(e,s){t(function(){var u=document.getElementById("appToolbar"),l=document.getElementById("rhpTabs"),c=$(l).children();return u?(o.appToolbar=$(u).outerHeight(!0),u&&!o.appToolbar?t(n(e,s),100):(o.tabsContainer=r(c),c.length&&!o.tabsContainer?t(n(e,s),100):(i&&(o.siblings=r(s.parent().siblings())),void a(e,s,o)))):t(n(e,s),100)})}function r(e){var t=0;return angular.forEach(e,function(e){t+=$(e).outerHeight(!0)}),t}function a(t,n,r){var a=e.innerHeight,i=0;angular.forEach(r,function(e){i+=e});var o=a-i;n.css("height",o+"px"),t.updateSize()}var i,o={listPadding:16};return{restrict:"A",link:function(t,s,u,l){t.includeSiblings&&(i=!0,t.$watch(function(){return r(s.parent().siblings())},function(e,t){e&&e!=t&&(o.siblings=e,a(l,s,o))})),n(l,s),a(l,s),angular.element(e).bind("resize",function(){n(l,s),t.$digest()})},require:"mdVirtualRepeatContainer",scope:{includeSiblings:"@"}}};angular.module(i).directive("virtualRepeatDynamicHeight",C),C.$inject=["$window","$timeout"],angular.module(i).filter("contains",["Utils",function(e){return function(t,n){return e.arrays(t).find(n).length>0}}]),angular.module(i).filter("eventListFilter",["Utils",function(e){return function(t,n){return t&&t.length&&n?e.arrays(t).findAll(n,["venue.name","fullDate","td.name"]):t}}]),angular.module(i).filter("venueListFilter",["Utils",function(e){return function(t,n){return t&&t.length&&n?e.arrays(t).findAll(n,["name","day","td.name"]):t}}]);var j=function(e,t,n,r){function a(){n.authenticate(!1),r.clearPermissions()}function i(e,t,n){return n?e.resolve({}):e.reject(t)}function o(n,r,a){var i=t.defer();return e.post(s+"/permission",{permissions:a}).then(function(){i.resolve({})},function(e){i.reject({redirectTo:n,redirectParams:r,code:e.data.code})}),i.promise}var s="/api/auth";return{isLoggedIn:function(n,r){var o=t.defer();return e.get(s).then(function(){o=i(o,{redirectTo:n,code:"User is authenticated"},!r)},function(e){a();var t={redirectTo:n,code:e.data.code};o=i(o,t,r)}),o.promise},authWithPermissions:function(e,t){return o(e,null,t)},authWithPermissionsPassParams:o}};angular.module(i).service("authProvider",j),j.$inject=["$http","$q","authService","permissionsService"];var V=function(e,t,n){var r="/api/auth";return{api:function(a){return e(r+"/:action",{id:a},{login:{method:"POST",params:{action:"login"},transformResponse:function(e,r,a){return t.authenticate(200===a),t.isAuth()&&n.setPermissions(),401===a&&(e={message:e}),angular.fromJson(e)}},logout:{method:"GET",params:{action:"logout"},transformResponse:function(e){return t.authenticate(!1),n.clearPermissions(),angular.fromJson(e)}}})}}};angular.module(i).factory("authApiService",V),V.$inject=["$resource","authService","permissionsService"];var U=function(){var e;return{isAuth:function(){return!!e},hasAuthenticated:function(){return void 0!==e},authenticate:function(t){e=!!t}}};angular.module(i).factory("authService",U),U.$inject=[];var O=function(e){return{confirm:function(t){var n=e.confirm({title:"Warning",textContent:t,ok:"Yes",cancel:"No"});return e.show(n)}}};angular.module(i).factory("dialogService",O),O.$inject=["$mdDialog"];var k=function(e){function t(){var t=[];return angular.forEach(e,function(e){"function"!=typeof e&&t.push(e)}),t}function n(){var t=[];return angular.forEach(s,function(n,r){var a=e.fromId(r);moment().isAfter(n)&&(t.push(a),i(r))}),t}function a(e){e&&e.length||(e=t()),angular.forEach(e,function(e){i(e)})}function i(e){var t=moment().add(u,"s").format();s[e]=t}var o=[],s={},u=300;return{changeEntity:function(e){-1===o.indexOf(e)&&(o.push(e),i(e))},getChangedEntites:function(){var e,t=n();return[].concat(r(new Set((e=o).concat.apply(e,r(t)))))},getStaleEntities:n,clearEntities:function(e){a(e),o=[]},clearChangedEntities:function(){a(o),o=[]},startEntityTimers:a}};angular.module(i).factory("entityService",k),k.$inject=["Entities"];var R=function(e,t){return{handleApiError:function(e){var n=e.config.data;switch(n.$$saving=!1,n.$$error=e.data,e.data.code){case"NO_USER_FOUND":t.authenticate(!1)}}}};angular.module(i).factory("errorService",R),R.$inject=["$state","authService"];var N=function(e,t,n,r){function a(e){var t=angular.fromJson(e);return s(t),t}function i(e){var t=angular.fromJson(e);return o(t),t}function o(e){angular.forEach(e,function(e){s(e)})}function s(e){e.fullDate=t("date")(e.date,"fullDate")}var u="/api/events";return{api:function(t){return e(u+"/:id/:action",{id:t},{save:{method:"POST",transformRequest:function(e){return n.changeEntity(r.EVENT),e.$$error&&delete e.$$error,e.$$saving=!0,angular.toJson(e)},transformResponse:function(e){return e.$$saving=!1,a(e)}},count:{method:"GET",params:{action:"count"}},byDate:{method:"GET",params:{action:"date"},isArray:!0,transformResponse:i},season:{method:"GET",url:u+"/season/:id",isArray:!0,transformResponse:i},query:{method:"GET",isArray:!0,transformResponse:i},get:{method:"GET",transformResponse:a}})}}};angular.module(i).factory("eventsService",N),N.$inject=["$resource","$filter","entityService","Entities"];var D=function(){return{resetValidity:function(e,t){if(e.$invalid)return e.$setValidity(t,!0)}}};angular.module(i).factory("formService",D),D.$inject=[];var I=function(e,t,n){var r="/api/games";return{api:function(a){return e(r+"/:id/:action",{id:a},{create:{method:"POST",transformRequest:function(e){return e.$$error&&delete e.$$error,e.$$saving=!0,angular.toJson(e)},transformResponse:function(e){return e.$$saving=!1,angular.fromJson(e)}},save:{method:"POST",params:{id:null},transformRequest:function(e){return t.changeEntity(n.GAME),e.$$error&&delete e.$$error,e.$$saving=!0,angular.toJson(e)},transformResponse:function(e){return e.$$saving=!1,angular.fromJson(e)}},byDate:{method:"GET",params:{action:"date"},isArray:!0}})}}};angular.module(i).factory("gamesService",I),I.$inject=["$resource","entityService","Entities"];var M=function(e,t){var n={goPrevious:function(){for(var e=r[r.length-1],n=e&&e.state.redirectTo;e&&t.current.name===e.state.name;)r.pop(),e=r[r.length-1];n&&(e=r[r.length-2]),e?n?r.slice(r.length-2,2):r.pop():e={state:"home",params:{}},a=!0,t.go(e.state,e.params).then(function(){a=!1})},isGoingBack:function(){return a},pushState:function(e,t){r.push({state:e,params:t})},hasHistory:function(){return!!r&&0!=r.length}},r=[],a=!1;return n};angular.module(i).factory("historyService",M),M.$inject=["$rootScope","$state"],function(e){function t(){}e.module(i).factory("homeService",t),t.$inject=[]}(angular);var L=function(e,t){function n(t){e.$broadcast(r,t)}var r="REFRESH_NAV_DATA";return{mainMenu:function(e){var r;return r=t("appSidenav",e),{toggle:function(e,t){return r.toggle().then(function(){e&&r.isOpen()&&n(t)})},nav:function(){return r}}},refreshNavData:n,onRefreshNavData:function(e,t){e.$on(r,function(e,n){try{t(n)}catch(e){console.error(e)}})}}};angular.module(i).factory("navService",L),L.$inject=["$rootScope","$mdSidenav"];var q=function(e,t,n,r){function a(e){return t(l,{id:e},{get:{method:"GET",transformResponse:function(e,t,n){return r.authenticate(200===n),angular.fromJson(e)}}})}function i(e,t){var a,o,s;if(1e3,10,a=!r.hasAuthenticated()||r.hasAuthenticated()&&r.isAuth(),s=!!Object.keys(c).length,o=10===e,e++,c&&s||!a||o){if(t&&"function"==typeof t)return t(c)}else n(function(){i(e,t)},1e3)}function o(e){return i(0,e)}function s(){a().get(function(e){c=e})}function u(e,t){return t[e]}var l,c;l="/api/auth/permissions",c={};var f={getPermissions:o,setPermissions:s,checkPermissions:function(t){var n=e.defer();return o(function(e){var r=!1;for(var a in t)u(t[a],e)||(n.reject({}),r=!0);r||n.resolve({})}),n.promise},clearPermissions:function(){c={}}};return s(),f};angular.module(i).factory("permissionsService",q),q.$inject=["$q","$resource","$timeout","authService"];var G=function(e,t,n){var r="/api/players";return{api:function(a){return e(r+"/:id/:action",{id:a},{save:{method:"POST",transformRequest:function(e){return t.changeEntity(n.PLAYER),e.$$error&&delete e.$$error,e.$$saving=!0,angular.toJson(e)},transformResponse:function(e){return e.$$saving=!1,angular.fromJson(e)}},findBy:{method:"PUT",isArray:!0},notIn:{method:"PUT",params:{action:"notIn"},isArray:!0},shoutOut:{method:"PUT",params:{action:"shoutOut"}},count:{method:"GET",params:{action:"count"}},validate:{method:"POST",params:{action:"validate"}}})}}};angular.module(i).factory("playersService",G),G.$inject=["$resource","entityService","Entities"],function(e){function t(e){var t="/api/seasons";return{api:function(n){return e(t+"/:id/:action",{id:n},{findBy:{method:"PUT",isArray:!0},notIn:{method:"PUT",params:{action:"notIn"},isArray:!0}})}}}e.module(i).factory("seasonsService",t),t.$inject=["$resource"]}(angular);var x=function(e,t){return{setParams:function(t){if(!t)return console.error("Cannot set $stateParams to null");e.go(".",t,{inherit:!1,notify:!1})},resetParams:function(n){var r=t.id,a={};n&&(a.id=r),e.go(".",a,{inherit:!1,notify:!1})}}};angular.module(i).factory("stateService",x),x.$inject=["$state","$stateParams"];var Y=function(e){var t="/api/stats";return{api:function(n,r){return e(t+"/:action/:id/:action2/:id2/:action3",{id:n,id2:r},{player:{method:"get",params:{action:"players"}},playerSeason:{method:"get",params:{action:"players",action2:"season"}},players:{method:"get",params:{action:"players"},isArray:!0},winners:{method:"get",params:{action:"winners"},isArray:!0},season:{method:"get",params:{action:"seasons"}},seasons:{method:"get",params:{action:"seasons",action2:"players"},isArray:!0},seasonWinners:{method:"get",params:{action:"seasons",actions2:"winners"},isArray:!0},currentSeasonWinners:{method:"get",params:{action:"seasons",action2:"winners",action3:"current"},isArray:!0}})}}};angular.module(i).factory("statsService",Y),Y.$inject=["$resource"],function(e){function t(t){var n="/api/users";return{api:function(r){return t(n+"/:action",{id:r},{save:{method:"POST",transformRequest:function(t){return t.$$saving=!0,e.toJson(t)},transformResponse:function(t){return t.$$saving=!1,e.fromJson(t)}}})}}}e.module(i).factory("usersService",t),t.$inject=["$resource"]}(angular);var F=function(e,t,n){var r="/api/venues";return{api:function(a){return e(r+"/:id/:action",{id:a},{save:{method:"POST",transformRequest:function(e){return t.changeEntity(n.VENUE),e.$$error&&delete e.$$error,e.$$saving=!0,angular.toJson(e)},transformResponse:function(e){return e.$$saving=!1,angular.fromJson(e)}},count:{method:"GET",params:{action:"count"}}})}}};angular.module(i).factory("venuesService",F),F.$inject=["$resource","entityService","Entities"],angular.module(i).config(["$stateProvider",function(e){e.state("login",{url:"login",parent:"home",templateUrl:"/views/login.html",controller:"loginCtrl",controllerAs:"lg",resolve:{auth:["authProvider",function(e){return e.isLoggedIn("home",!0)}]}}).state("register",{url:"register",parent:"home",templateUrl:"/views/register.html",controller:"registerCtrl",controllerAs:"rg",resolve:{auth:["authProvider",function(e){return e.isLoggedIn("home",!0)}]}})}]),angular.module(i).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/events","/events/list"),e.state("events",{url:"events",parent:"home",templateUrl:"/views/events.html",controller:"eventsCtrl",controllerAs:"events",redirectTo:"events.list"}).state("events.list",{url:"/list",parent:"events",templateUrl:"/views/events.list.html",controller:"eventsListCtrl",controllerAs:"el"}).state("events.manage",{url:"/manage/:id",parent:"events",templateUrl:"/views/events.manage.html",controller:"eventsManageCtrl",controllerAs:"em",historyIgnore:!0,resolve:{auth:["authProvider","$stateParams",function(e,t){var n=[];return n.push(t.id?"EDIT_EVENT":"ADD_EVENT"),e.authWithPermissions("events.list",n)}]}}).state("events.view",{url:"/view/:id",parent:"events",templateUrl:"/views/events.view.html",controller:"eventsViewCtrl",controllerAs:"ev"})}]),angular.module(i).config(["$stateProvider",function(e){e.state("games",{url:"games",parent:"home",templateUrl:"/views/games.html",controller:"gamesCtrl",controllerAs:"games",redirectTo:"games.play",abstract:!0}).state("games.view",{url:"/view/:id",parent:"games",templateUrl:"/views/games.view.html",controller:"gamesViewCtrl",controllerAs:"gv"}).state("games.play",{url:"/play/:id",parent:"games",templateUrl:"/views/games.play.html",controller:"gamesPlayCtrl",controllerAs:"gp",resolve:{auth:["authProvider","$stateParams",function(e,t){return e.authWithPermissionsPassParams("games.view",{id:t.id},["PLAY_GAME"])}]}}).state("games.players",{url:"/players",parent:"games.play",templateUrl:"/views/games.players.html",controller:"gamesPlayersCtrl",controllerAs:"gp",historyIgnore:!0}).state("games.players.add",{url:"/:gameId/players/add",parent:"games",templateUrl:"/views/games.players.add.html",controller:"gamesPlayersCtrl",controllerAs:"gp",historyIgnore:!0,resolve:{auth:["authProvider","$stateParams",function(e,t){return e.authWithPermissionsPassParams("games.view",{id:t.id},["PLAY_GAME"])}]}})}]),angular.module(i).config(["$urlRouterProvider","$stateProvider",function(e,t){e.otherwise("/"),t.state("home",{url:"/",templateUrl:"/views/home.html",controller:"homeCtrl",controllerAs:"home"})}]).run(["$rootScope","$state","authService","historyService",function(e,t,n,r){e.$on("$stateChangeSuccess",function(e,t,n,a,i){a.abstract||r.isGoingBack()||a.historyIgnore||r.pushState(a,i)}),e.$on("$stateChangeError",function(e,a,i,o,s,u){switch(r.hasHistory()||r.pushState(a,i),u.code){case"NO_USER_FOUND":n.authenticate(!1),t.go("login");break;case"PERMISSIONS_INVALID":console.log("Redirect to "+u.redirectTo+" because "+u.code),t.transitionTo(u.redirectTo,{reason:u.code});break;default:console.error("No error code found, redirecting home",u),t.go("home")}})}]),angular.module(i).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/players","/players/list"),e.state("players",{url:"players",parent:"home",templateUrl:"/views/players.html",controller:"playersCtrl",controllerAs:"players",redirectTo:"players.list"}).state("players.list",{url:"/list",parent:"players",templateUrl:"/views/players.list.html",controller:"playersListCtrl",controllerAs:"pl"}).state("players.manage",{url:"/manage/:id",params:{season:null,allTime:!1},parent:"players",templateUrl:"/views/players.manage.html",controller:"playersManageCtrl",controllerAs:"pm",historyIgnore:!0,resolve:{auth:["authProvider","$stateParams",function(e,t){var n=[];return n.push(t.id?"EDIT_PLAYER":"ADD_PLAYER"),e.authWithPermissions("players.list",n)}]}}).state("players.view",{url:"/view/:id",params:{season:null,allTime:!1},parent:"players",templateUrl:"/views/players.view.html",controller:"playersViewCtrl",controllerAs:"pv"}).state("players.view.games",{url:"/view/:id/games",params:{season:null,allTime:!1},parent:"players",templateUrl:"/views/players.view.games.html",controller:"playersViewCtrl",controllerAs:"pv"})}]),angular.module(i).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/seasons","/seasons/view"),e.state("seasons",{url:"seasons",parent:"home",templateUrl:"/views/seasons.html",controller:"seasonsCtrl",controllerAs:"seasons",redirectTo:"seasons.view"}).state("seasons.view",{url:"/view",parent:"seasons",templateUrl:"/views/seasons.view.html",controller:"seasonsViewCtrl",controllerAs:"vm"})}]),angular.module(i).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/stats","/stats/season"),e.state("stats",{url:"stats",parent:"home",templateUrl:"/views/stats.html",controller:"statsCtrl",controllerAs:"vm",redirectTo:"stats.season"}).state("stats.season",{url:"/season",parent:"stats",params:{all:null},templateUrl:"/views/stats.season.html",controller:"statsSeasonCtrl",controllerAs:"vm"}).state("stats.seasons",{url:"/seasons/:id",parent:"stats",templateUrl:"/views/stats.season.html",controller:"statsSeasonCtrl",controllerAs:"vm"}).state("stats.season.all",{url:"/seasons/all/:id",parent:"stats",params:{all:null},templateUrl:"/views/stats.season.all.html",controller:"statsSeasonCtrl",controllerAs:"vm"})}]),angular.module(i).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/venues","/venues/list"),e.state("venues",{url:"venues",parent:"home",templateUrl:"/views/venues.html",controller:"venuesCtrl",controllerAs:"venues",redirectTo:"venues.list"}).state("venues.list",{params:{reason:null},url:"/list",parent:"venues",templateUrl:"/views/venues.list.html",controller:"venuesListCtrl",controllerAs:"vl"}).state("venues.manage",{url:"/manage/:id",parent:"venues",templateUrl:"/views/venues.manage.html",controller:"venuesManageCtrl",controllerAs:"vm",historyIgnore:!0,resolve:{auth:["authProvider","$stateParams",function(e,t){var n=[];return n.push(t.id?"EDIT_VENUE":"ADD_VENUE"),e.authWithPermissions("venues.list",n)}]}}).state("venues.view",{url:"/view/:id",parent:"venues",templateUrl:"/views/venues.view.html",controller:"venuesViewCtrl",controllerAs:"vv"})}]);var J=function(e,t,n){function r(t,n,r){if(t&&Array.isArray(t))return e("filter")(t,n,r);console.error(l)}function a(e,t,n){var a,i=r(e,t,!0);switch(i.length){case 0:break;case 1:a=n?i[0]:angular.copy(i[0]);break;default:console.error("More than one record found in array for",t,"Please provide a unique filter for this array.")}return a}function i(e){var t=[];{if(e&&Array.isArray(e))return angular.forEach(e,function(e){Array.isArray(e)&&(t=t.concat(e))}),t;console.error(l)}}function o(e,t){if(e&&Array.isArray(e))return t?n.isString(t)?e.filter(function(e,n,r){return r.map(function(e){return e[t]}).indexOf(e[t])===n}):(console.error("Cannot reduce a non-String property. Provide a String to match on as the second argument.","Returning original array value."),e):(console.error("Cannot reduce an undefined property. Provide a property to match on as the second argument.","Returning original array value."),e);console.error(l)}function s(e){return o(e,c)}function u(e,t){return e.indexOf(a(e,t,!0))}var l="This method requires an array as the first argument.",c="_id";return{find:r,findOne:a,findAll:function(e,n,a,o){if(e&&Array.isArray(e)){if(a&&!Array.isArray(a)){var u=angular.copy(a);(a=[]).push(u)}if(!a||!Array.isArray(a))return console.error("No valid properties to filter on, returning original array value."),e;var c=[];return angular.forEach(a,function(a){c.push(r(e,t.setProperty(a,n),o))}),s(i(c))}console.error(l)},join:i,uniqById:s,uniq:o,indexOf:u,orderedIndexOf:function(t,n,r){return u(e("orderBy")(t,n),r)},addOrRemove:function(e,t){var n=u(e,t);n>-1?e.splice(n,1):e.push(t)}}};angular.module(i).factory("arrayUtil",J),J.$inject=["$filter","objectUtil","stringUtil"];var B=function(){function e(e){var r=Object.prototype.toString.call(e)===t,i=e instanceof Object,o=(void 0===e?"undefined":a(e))===n;return r&&i&&o}var t="[object Object]",n="object";return{setProperty:function(t,n,r){return e(r)||(r={}),_.set(r,t,n)}}};angular.module(i).factory("objectUtil",B),B.$inject=[];var W=function(){var e="[object String]";return{isString:function(t){var n=Object.prototype.toString.call(t)===e;String,void 0===t||a(t);return n}}};angular.module(i).factory("stringUtil",W),W.$inject=[];var H=function(e,t){var n="This method requires an Array as the first argument.";return{arrays:function(t){return t&&Array.isArray(t)?{find:function(n,r){return e.find(t,n,r)},findOne:function(n){return e.findOne(t,n)},findAll:function(n,r,a){return e.findAll(t,n,r,a)},indexOf:function(n){return e.indexOf(t,n)},orderedIndexOf:function(n,r){return e.orderedIndexOf(t,n,r)},addOrRemove:function(n){return e.addOrRemove(t,n)}}:(console.error(n),{})},objects:function(e){return{setProperty:function(n,r){return t.setProperty(n,r,e)}}},strings:function(e){return{isString:function(){return stringUtil.isString(e)}}}}};angular.module(i).factory("Utils",H),H.$inject=["arrayUtil","objectUtil"]},{}]},{},[1]);